)]}'
{"version":3,"file":"/packages/jag:pince.js","sources":["jag:pince/src/microevent.coffee","jag:pince/src/console.coffee","jag:pince/src/logger.coffee"],"names":[],"mappings":"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","sourcesContent":["# This is a simple port of microevent.js to Coffeescript. I've changed the\n# function names to be consistent with node.js EventEmitter.\n#\n# microevent.js is copyright Jerome Etienne, and licensed under the MIT license:\n# https://github.com/jeromeetienne/microevent.js\n# Initial conversion to Coffeescript was done by Joseph Gentle in ShareJS\n# https://github.com/share/ShareJS\n\nnextTick = if process?.nextTick? then process.nextTick else (fn) -> setTimeout fn, 0\n\nclass MicroEvent\n  on: (event, fct) ->\n    @_events ||= {}\n    @_events[event] ||= []\n    @_events[event].push(fct)\n    this\n\n  removeListener: (event, fct) ->\n    @_events ||= {}\n    listeners = (@_events[event] ||= [])\n    \n    # Sadly, there's no IE8- support for indexOf.\n    i = 0\n    while i < listeners.length\n      listeners[i] = undefined if listeners[i] == fct\n      i++\n\n    nextTick => @_events[event] = (x for x in @_events[event] when x)\n\n    this\n\n  emit: (event, args...) ->\n    return this unless @_events?[event]\n    fn.apply this, args for fn in @_events[event] when fn\n    this\n\n# mixin will delegate all MicroEvent.js function in the destination object\nMicroEvent.mixin = (obj) ->\n  proto = obj.prototype || obj\n\n  # Damn closure compiler :/\n  proto.on = MicroEvent.prototype.on\n  proto.removeListener = MicroEvent.prototype.removeListener\n  proto.emit = MicroEvent.prototype.emit\n  obj\n\nisBrowser = 'undefined' != typeof window\nisMeteor = 'undefined' != typeof Meteor\nif isBrowser || isMeteor\n  @MicroEvent = MicroEvent\nelse\n  module.exports = MicroEvent\n\n\n","isBrowser = 'undefined' != typeof window\nisMeteor = 'undefined' != typeof Meteor\nPince = {}\n\n# Taken from meteor Meteor._debug\nPince._browserOut = ->\n  #can't do much with very old browsers\n  return unless console?.log?\n  # IE Companion breaks otherwise\n  # IE10 PP4 requires at least one argument\n  return console.log('') if (arguments.length == 0)\n\n  # IE doesn't have console.log.apply, it's not a real Object.\n  # http:#stackoverflow.com/questions/5538972/console-log-apply-not-working-in-ie9\n  # http:#patik.com/blog/complete-cross-browser-console-log/\n  if (typeof console.log.apply == \"function\")\n    # Most browsers\n    console.log.apply(console, arguments)\n  else if (typeof Function.prototype.bind == \"function\")\n    # IE9\n    log = Function.prototype.bind.call(console.log, console)\n    log.apply(console, arguments)\n  else\n    # IE8\n    Function.prototype.call.call(console.log, console, Array.prototype.slice.call(arguments))\n\nPince._browserErr = ->\n  #can't do much with very old browsers\n  return unless console?.error?\n  # IE Companion breaks otherwise\n  # IE10 PP4 requires at least one argument\n  return console.error('') if (arguments.length == 0)\n\n  # IE doesn't have console.log.apply, it's not a real Object.\n  # http:#stackoverflow.com/questions/5538972/console-log-apply-not-working-in-ie9\n  # http:#patik.com/blog/complete-cross-browser-console-log/\n  if (typeof console.error.apply == \"function\")\n    # Most browsers\n    console.error.apply(console, arguments)\n  else if (typeof Function.prototype.bind == \"function\")\n    # IE9\n    error = Function.prototype.bind.call(console.error, console)\n    error.apply(console, arguments)\n  else\n    # IE8\n    Function.prototype.call.call(console.error, console, Array.prototype.slice.call(arguments))\n\nPince.out = (messages) ->\n  if (isBrowser)\n    Pince._browserOut.apply(this, messages)\n  else\n    console.log.apply(console, messages)\n\nPince.err = (messages) ->\n  if (isBrowser)\n    Pince._browserOut.apply(this, messages)\n  else\n    console.error.apply(console, messages)\n\nif isBrowser || isMeteor\n  @Pince = Pince\nelse\n  module.exports = Pince\n\n","isMeteor = 'undefined' != typeof Meteor\nisBrowser = 'undefined' != typeof window\n\nif isBrowser\n  moment = (date) -> moment\n  moment.format = (format) -> \"\"\n  EventEmitter = MicroEvent\nelse #isServer\n  if isMeteor\n    moment = Npm.require 'moment'\n    {EventEmitter} = Npm.require 'events'\n  else\n    moment = require 'moment'\n    {EventEmitter} = require 'events'\n    Pince = require './console.coffee'\n\n__levelnums =\n  error: 0\n  warn: 1\n  info: 2\n  debug: 3\n  trace: 4\n\nnoop = (x) -> x\nif isBrowser\n  colors =\n    error: noop\n    warn: noop\n    info: noop\n    debug: noop\n    trace: noop\nelse\n  if isMeteor\n    clc = Npm.require 'cli-color'\n  else\n    clc = require 'cli-color'\n\n  colors =\n    error: clc.red.bold\n    warn: clc.yellow\n    info: clc.bold\n    debug: clc.blue\n    trace: clc.blackBright\n\nLOG_PREFIX = 'MADEYE_LOGLEVEL'\nparseDefaultLogLevel = ->\n  if isBrowser\n    if isMeteor\n      defaultLogLevel = Meteor.settings?.public?.logLevel\n    else\n      defaultLogLevel = null\n  else\n    defaultLogLevel = process.env[LOG_PREFIX]\n  return defaultLogLevel\n\nparseSpecificLogLevels = ->\n  if isBrowser\n    if isMeteor\n      return Meteor.settings?.public?.specificLogLevels ? {}\n    else\n      return {}\n\n  specificLogLevels = {}\n  for k,v of process.env\n    continue unless k.indexOf(\"#{LOG_PREFIX}_\") == 0\n    continue if k == LOG_PREFIX\n    name = k.substr \"#{LOG_PREFIX}_\".length\n    name = name.split('_').join(':')\n    specificLogLevels[name] = v\n  return specificLogLevels\n\n\n__loggerLevel = parseDefaultLogLevel() ? 'info'\n__specificLoggerLevels = parseSpecificLogLevels()\n\n__onError = null\n\nclass Listener\n  constructor: (options) ->\n    options ?= {}\n    if 'string' == typeof options\n      options = logLevel: options\n    #Default logLevel\n    @logLevel = options.logLevel ? __loggerLevel\n    #logLevels for specific loggers\n    @logLevels = options.logLevels ? __specificLoggerLevels\n    #remember loggers for changing levels later\n    @loggers = {}\n    # Need to remember these to detach\n    # name: {level: fn}\n    @listenFns = {}\n\n  _reattachLoggers: ->\n    #recalculate how we listen to listeners and loggers\n    for name, logger of @loggers\n      @detach name\n      @listen logger, name\n\n  #setLevel(level) sets the global default level\n  #setLevel(name, level) sets the level for name\n  setLevel: (name, level) ->\n    #setLevel(name, level)\n    if level\n      throw new Error 'Must supply a name' unless name\n\n      levels = {}\n      levels[name] = level\n      @setLevels levels\n      return\n\n    #setLevel(level)\n    level = name\n    throw new Error 'Must supply a level' unless level\n    return if @logLevel == level\n    @logLevel = level\n    @_reattachLoggers()\n    return\n\n  #levels is an object {name:level} which sets each name to level\n  setLevels: (levels) ->\n    for name, level of levels\n      @logLevels[name] = level\n    @_reattachLoggers()\n    return\n\n  #Check first for any specific levels\n  findLevelFor: (name) ->\n    level = @logLevels[name]\n\n    #Check hierarchically up the : chain\n    parentName = name\n    while (parentName.indexOf(':') > -1) and not level\n      lastIdx = parentName.lastIndexOf(':')\n      parentName = parentName.substr 0, lastIdx\n      parentLevel = @logLevels[parentName]\n      level ?= parentLevel\n      break if level\n\n\n    level ?= @logLevel\n    return level\n\n  listen: (logger, name) ->\n    unless logger\n      throw Error \"An object is required for logging!\"\n    unless name\n      throw Error \"Name is required for logging!\"\n    @loggers[name] = logger\n    @logLevels[name] = level if level\n\n    level = @findLevelFor name\n\n    #TODO: Detach possibly existing logger\n    @listenFns[name] = {}\n\n    errorFn = (msgs...) =>\n      shouldPrint = __onError? msgs\n      #Be explicit about false, to not trigger on undefined/null\n      unless shouldPrint == false\n        @handleLog timestamp: new Date, level:'error', name:name, message:msgs\n    logger.on 'error', errorFn\n    @listenFns[name]['error'] = errorFn\n\n    ['warn', 'info', 'debug', 'trace'].forEach (l) =>\n      return if __levelnums[l] > __levelnums[level]\n      listenFn = (msgs...) =>\n        @handleLog timestamp: new Date, level:l, name:name, message:msgs\n      logger.on l, listenFn\n      @listenFns[name][l] = listenFn\n    return\n\n  detach: (name) ->\n    logger = @loggers[name]\n    return unless logger\n    for level, listenFn of @listenFns[name]\n      logger.removeListener level, listenFn\n    delete @listenFns[name]\n    delete @loggers[name]\n    #delete @logLevels[name]\n    return\n  \n  handleLog: (data) ->\n    timestr = moment(data.timestamp).format(\"YYYY-MM-DD HH:mm:ss.SSS\")\n    color = colors[data.level]\n    prefix = \"#{timestr} #{color(data.level+\": \")} \"\n    prefix += \"[#{data.name}] \" if data.name\n\n    if 'string' == typeof data.message\n      messages = [data.message]\n    else\n      messages = data.message\n\n    messages.unshift prefix\n  \n    if __levelnums[data.level] <= __levelnums['warn']\n      Pince.err messages\n    else\n      Pince.out messages\n\nlistener = new Listener()\n\nclass Logger extends EventEmitter\n  constructor: (options) ->\n    options ?= {}\n    if 'string' == typeof options\n      options = name: options\n    @name = options.name\n    listener.listen this, options.name, options.logLevel\n\n  @setLevel: (level) ->\n    listener.setLevel.apply listener, arguments\n\n  @setLevels: (levels) ->\n    listener.setLevels.apply listener, arguments\n\n  @onError: (callback) ->\n    __onError = callback\n\n  @listen: (logger, name, level) ->\n    listener.listen logger, name, level\n\n  #take single message arg, that is an array.\n  _log: (level, messages) ->\n    messages.unshift level\n    @emit.apply this, messages\n\n  #take multiple args\n  log: (level, messages...) -> @_log level, messages\n\n  trace: (messages...) -> @_log 'trace', messages\n  debug: (messages...) -> @_log 'debug', messages\n  info: (messages...) -> @_log 'info', messages\n  warn: (messages...) -> @_log 'warn', messages\n  error: (messages...) -> @_log 'error', messages\n\n@Logger = Logger\nLogger.listener = listener\nunless typeof exports == \"undefined\"\n  module.exports = Logger\n"]}